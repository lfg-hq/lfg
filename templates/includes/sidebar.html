<div class="sidebar-overlay" id="sidebar-overlay"></div>
<div class="sidebar{% if sidebar_minimized %} minimized{% endif %}" id="sidebar"{% if current_project %} data-current-project-id="{{ current_project.project_id }}"{% endif %}>
    <div class="sidebar-top-content">
        <div class="sidebar-header">
            <div class="logo-section">
                <span class="logo-icon">ðŸš€</span>
                <span class="logo-text">LFG</span>
            </div>
            <button id="minimize-btn" class="icon-btn" title="Collapse Sidebar">
                <i class="fas fa-chevron-left"></i>
            </button>
        </div>
        <div class="project-selector-section">
            {% if current_project %}
            <div class="nav-dropdown-container" id="projectDropdownContainer">
                <button class="project-dropdown-trigger" id="projectDropdownTrigger" title="{% if current_project %}Project Options{% else %}All Projects{% endif %}">
                    <i class="fas fa-folder{% if current_project %}-open{% endif %}"></i>
                    <span class="project-name-text">{% if current_project %}{{ current_project.name|truncatechars:18 }}{% else %}All Projects{% endif %}</span>
                    <i class="fas fa-chevron-down dropdown-arrow"></i>
                </button>
                <div class="nav-dropdown" id="projectDropdown">
                    <a href="{% url 'projects:project_list' %}" class="nav-dropdown-item{% if not current_project %} active{% endif %}">
                        <i class="fas fa-th-large"></i>
                        <span>All Projects</span>
                    </a>
                    {% if current_project %}
                    <a href="{% url 'projects:project_detail' project_id=current_project.project_id %}" class="nav-dropdown-item">
                        <i class="fas fa-tachometer-alt"></i>
                        <span>Project Dashboard</span>
                    </a>
                    {% endif %}
                </div>
            </div>
            {% else %}
            <a href="{% url 'projects:project_list' %}" class="project-dropdown-trigger" title="All Projects">
                <i class="fas fa-folder"></i>
                <span class="project-name-text">All Projects</span>
            </a>
            {% endif %}
        </div>
        {% if current_project %}
        <div class="new-chat-section">
            <a href="{% if show_conversations %}#{% else %}{% url 'index' %}{% endif %}" id="new-chat-btn" class="new-chat-link{% if not show_conversations %} disabled{% endif %}" title="New Chat">
                <i class="fas fa-pen-to-square"></i>
                <span class="button-text">New chat</span>
            </a>
        </div>
        <div class="sidebar-nav">
            <a href="{% url 'instant_mode' project_id=current_project.project_id %}" class="nav-link{% if request.resolver_match.url_name == 'instant_mode' or request.resolver_match.url_name == 'instant_app_detail' %} active{% endif %}" title="Instant">
                <i class="fas fa-bolt"></i>
                <span class="nav-text">Instant</span>
            </a>
            <a href="#" class="nav-link chat-link{% if request.resolver_match.url_name == 'index' or request.resolver_match.url_name == 'conversation_detail' or request.resolver_match.url_name == 'create_conversation' %} active{% endif %}" title="Chat">
                <i class="fas fa-comments"></i>
                <span class="nav-text">Chat</span>
            </a>
            <a href="{% url 'projects:project_detail' project_id=current_project.project_id %}" class="nav-link{% if request.resolver_match.url_name == 'project_detail' %} active{% endif %}" title="Project Dashboard">
                <i class="fas fa-tachometer-alt"></i>
                <span class="nav-text">Project Dashboard</span>
            </a>
            <a href="{% url 'projects:project_tickets_list' project_id=current_project.project_id %}" class="nav-link{% if request.resolver_match.url_name == 'project_tickets_list' %} active{% endif %}" title="Tickets">
                <i class="fas fa-tasks"></i>
                <span class="nav-text">Tickets</span>
            </a>
            <a href="{% url 'projects:app_preview' project_id=current_project.project_id %}" class="nav-link{% if request.resolver_match.url_name == 'app_preview' %} active{% endif %}" title="Preview">
                <i class="fas fa-eye"></i>
                <span class="nav-text">Preview</span>
            </a>
        </div>
        {% endif %}
        {% if show_conversations %}
        <div class="conversations-section">
            <h3 class="sidebar-section-title">Recents</h3>
            <div class="conversation-list" id="conversation-list">
                <!-- Conversations will be loaded here -->
            </div>
        </div>
        {% endif %}
    </div>
    <div class="sidebar-bottom-content">
        <div class="sidebar-nav bottom-nav">
            <!-- Theme Toggle -->
            <button class="nav-link theme-toggle-sidebar" id="sidebar-theme-toggle" title="Toggle light/dark mode" data-theme-toggle>
                <i class="fas fa-sun theme-icon-light"></i>
                <i class="fas fa-moon theme-icon-dark"></i>
                <span class="nav-text theme-text">Light Mode</span>
            </button>
            <div class="nav-link token-display" data-tooltip="Total tokens used today across all conversations">
                <i class="fas fa-chart-line"></i>
                <span class="nav-text">
                    <span id="daily-tokens">0</span>
                    <span class="token-label">tokens today</span>
                </span>
                <span class="minimized-tokens" id="minimized-tokens">0</span>
            </div>
        </div>
        <div class="user-info" id="user-info">
            {% if user.is_authenticated %}
                <button class="user-info-button" id="user-info-button">
                    <div class="user-avatar">
                        {% if user.profile.avatar %}
                            <img src="{{ user.profile.avatar.url }}" alt="{{ user.username }}'s avatar">
                        {% else %}
                            <div class="avatar-text">{{ user.username|first|upper }}</div>
                        {% endif %}
                    </div>
                    <div class="user-details">
                        <span class="username">{{ user.email }}</span>
                    </div>
                    <i class="fas fa-chevron-down dropdown-icon"></i>
                </button>
                <div class="user-dropdown" id="user-dropdown">
                    <a href="{% url 'settings' %}" class="dropdown-item">
                        <i class="fas fa-cog"></i>
                        <span>Settings</span>
                    </a>
                    <!-- <a href="{% url 'accounts:organization_list' %}" class="dropdown-item">
                        <i class="fas fa-users"></i>
                        <span>Organizations</span>
                    </a> -->
                    <div class="dropdown-divider"></div>
                    <a href="{% url 'accounts:logout' %}" class="dropdown-item">
                        <i class="fas fa-sign-out-alt"></i>
                        <span>Logout</span>
                    </a>
                </div>
            {% else %}
                <a href="{% url 'accounts:login' %}" class="login-button">Log In</a>
            {% endif %}
        </div>
    </div>
</div>
